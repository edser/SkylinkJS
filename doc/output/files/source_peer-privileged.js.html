<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Temasys Web SDK Documentation (0.6.19)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="name" content="skylinkjs">
  <meta name="version" content="0.6.19">
  <!-- Favicon -->
  <link href="../assets/img/favicon.ico" rel="shortcut icon" type="image/x-icon">
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono" rel="stylesheet">
  <link href="../assets/vendor/font-awesome.min.css" rel="stylesheet" type="text/css">
  <!-- Styles -->
  <link href="../assets/vendor/prettify.min.css" rel="stylesheet" type="text/css">
  <link href="../assets/css/main.css" rel="stylesheet" type="text/css">
  <script src="../assets/vendor/jquery.min.js" type="text/javascript"></script>
  <script src="../assets/vendor/prettify.min.js" type="text/javascript"></script>
  <script src="../assets/js/main.js" type="text/javascript"></script>
</head>
<body>
  <!-- Navigation Header -->
  <navbar class="top">
    <a class="main" href="/">
      <img src="../assets/img/favicon.ico">
      <strong>Temasys</strong> Web SDK
    </a>
    <ul class="menu">
      <li><a href="https://github.com/Temasys/SkylinkJS" target="_blank">SkylinkJS Github</a></li>
      <li><a href="https://console.temasys.io/" target="_blank">Developer Console</a></li>
    </ul>
  </navbar>

  <!-- Body -->
  <section class="container">
    <div class="container-wrapper">
      <!-- Side Navigation -->
      <navbar class="side">
        <div id="side-menu" class="navbar-wrapper">
          <ul class="menu">
            <div class="section">
              <span class="header">Getting Started</span>    
              <li>
              <a href="#">1. Overview <i class="fa fa-caret-down"></i></a>
              <ul>
                  <li><a href="#">a. Architecture</a></li>
                  <li><a href="#">b. Authentication Methods</a></li>
                  <li><a href="#">c. Persistent Rooms</a></li>
                  <li><a href="#">d. Auto-Introduce & Privileged</a></li>
              </ul>
              </li>
              <li>
              <a href="#">2. Integrating to Your Site <i class="fa fa-caret-down"></i></a>
              <ul>
                  <li><a href="#">a. Referencing the SDK</a></li>
                  <li><a href="#">b. Code Samples</a></li>
                  <li><a href="#">c. Integrating your extensions & WebRTC plugin</a></li>
              </ul>
              </li>
              <li><a href="#" class="nodropdown">3. Demos</a></li>
            </div>
            <div class="section">
              <span class="header">API Documentation</span>
              <li>
                <a href="#">Temasys <small>module</small><i class="fa fa-caret-down"></i></a>
                <ul>
                </ul>
              </li>
                  ([&quot;Room&quot;,&quot;test&quot;])
                  <li>
                    <a href="classes/Room.html" class="nodropdown">
                      Room <small>class</small>
                    </a>
                  </li>
                  ([&quot;Skylink&quot;,&quot;test&quot;])
                  <li>
                    <a href="classes/Skylink.html" class="nodropdown">
                      Skylink <small>class</small>
                    </a>
                  </li>
                  ([&quot;Socket&quot;,&quot;test&quot;])
                  <li>
                    <a href="classes/Socket.html" class="nodropdown">
                      Socket <small>class</small>
                    </a>
                  </li>
                  ([&quot;Temasys.Peer&quot;,&quot;test&quot;])
                  <li>
                    <a href="classes/Temasys.Peer.html" class="nodropdown">
                      Temasys.Peer <small>class</small>
                    </a>
                  </li>
                  ([&quot;Temasys.Room&quot;,&quot;test&quot;])
                  <li>
                    <a href="classes/Temasys.Room.html" class="nodropdown">
                      Temasys.Room <small>class</small>
                    </a>
                  </li>
                  ([&quot;Temasys.Socket&quot;,&quot;test&quot;])
                  <li>
                    <a href="classes/Temasys.Socket.html" class="nodropdown">
                      Temasys.Socket <small>class</small>
                    </a>
                  </li>
                  ([&quot;Temasys.Utils&quot;,&quot;test&quot;])
                  <li>
                    <a href="classes/Temasys.Utils.html" class="nodropdown">
                      Temasys.Utils <small>class</small>
                    </a>
                  </li>
                  ([&quot;Utils&quot;,&quot;test&quot;])
                  <li>
                    <a href="classes/Utils.html" class="nodropdown">
                      Utils <small>class</small>
                    </a>
                  </li>
            </div>
          </ul>
        </div>
      </navbar>      <!-- Content -->
      <h1 class="file-heading">File: source/peer-privileged.js</h1>
      
      <div class="file">
          <pre class="code prettyprint linenums">
      /**
       * &lt;blockquote class=&quot;info&quot;&gt;
       *   Note that this feature requires &lt;code&gt;&quot;isPrivileged&quot;&lt;/code&gt; flag to be enabled for the App Key
       *   provided in the &lt;a href=&quot;#method_init&quot;&gt;&lt;code&gt;init()&lt;/code&gt; method&lt;/a&gt;, as only Users connecting using
       *   the App Key with this flag enabled (which we call privileged Users / Peers) can retrieve the list of
       *   Peer IDs from Rooms within the same App space.
       *   &lt;a href=&quot;http://support.temasys.io/support/solutions/articles/12000012342-what-is-a-privileged-key-&quot;&gt;
       *   Read more about privileged App Key feature here&lt;/a&gt;.
       * &lt;/blockquote&gt;
       * The list of &lt;a href=&quot;#method_getPeers&quot;&gt;&lt;code&gt;getPeers()&lt;/code&gt; method&lt;/a&gt; retrieval states.
       * @attribute GET_PEERS_STATE
       * @param {String} ENQUIRED &lt;small&gt;Value &lt;code&gt;&quot;enquired&quot;&lt;/code&gt;&lt;/small&gt;
       *   The value of the state when &lt;code&gt;getPeers()&lt;/code&gt; is retrieving the list of Peer IDs
       *   from Rooms within the same App space from the Signaling server.
       * @param {String} RECEIVED &lt;small&gt;Value &lt;code&gt;&quot;received&quot;&lt;/code&gt;&lt;/small&gt;
       *   The value of the state when &lt;code&gt;getPeers()&lt;/code&gt; has retrieved the list of Peer IDs
       *   from Rooms within the same App space from the Signaling server successfully.
       * @type JSON
       * @readOnly
       * @for Skylink
       * @since 0.6.1
       */
      Skylink.prototype.GET_PEERS_STATE = {
      	ENQUIRED: &#x27;enquired&#x27;,
      	RECEIVED: &#x27;received&#x27;
      };
      
      /**
       * &lt;blockquote class=&quot;info&quot;&gt;
       *   Note that this feature requires &lt;code&gt;&quot;isPrivileged&quot;&lt;/code&gt; flag to be enabled and
       *   &lt;code&gt;&quot;autoIntroduce&quot;&lt;/code&gt; flag to be disabled for the App Key provided in the
       *   &lt;a href=&quot;#method_init&quot;&gt;&lt;code&gt;init()&lt;/code&gt; method&lt;/a&gt;, as only Users connecting using
       *   the App Key with this flag enabled (which we call privileged Users / Peers) can retrieve the list of
       *   Peer IDs from Rooms within the same App space.
       *   &lt;a href=&quot;http://support.temasys.io/support/solutions/articles/12000012342-what-is-a-privileged-key-&quot;&gt;
       *   Read more about privileged App Key feature here&lt;/a&gt;.
       * &lt;/blockquote&gt;
       * The list of &lt;a href=&quot;#method_introducePeer&quot;&gt;&lt;code&gt;introducePeer&lt;/code&gt; method&lt;/a&gt; Peer introduction request states.
       * @attribute INTRODUCE_STATE
       * @param {String} INTRODUCING &lt;small&gt;Value &lt;code&gt;&quot;enquired&quot;&lt;/code&gt;&lt;/small&gt;
       *   The value of the state when introduction request for the selected pair of Peers has been made to the Signaling server.
       * @param {String} ERROR       &lt;small&gt;Value &lt;code&gt;&quot;error&quot;&lt;/code&gt;&lt;/small&gt;
       *   The value of the state when introduction request made to the Signaling server
       *   for the selected pair of Peers has failed.
       * @readOnly
       * @for Skylink
       * @since 0.6.1
       */
      Skylink.prototype.INTRODUCE_STATE = {
      	INTRODUCING: &#x27;introducing&#x27;,
      	ERROR: &#x27;error&#x27;
      };
      
      /**
       * &lt;blockquote class=&quot;info&quot;&gt;
       *   Note that this feature requires &lt;code&gt;&quot;isPrivileged&quot;&lt;/code&gt; flag to be enabled for the App Key
       *   provided in the &lt;a href=&quot;#method_init&quot;&gt;&lt;code&gt;init()&lt;/code&gt; method&lt;/a&gt;, as only Users connecting using
       *   the App Key with this flag enabled (which we call privileged Users / Peers) can retrieve the list of
       *   Peer IDs from Rooms within the same App space.
       *   &lt;a href=&quot;http://support.temasys.io/support/solutions/articles/12000012342-what-is-a-privileged-key-&quot;&gt;
       *   Read more about privileged App Key feature here&lt;/a&gt;.
       * &lt;/blockquote&gt;
       * Function that retrieves the list of Peer IDs from Rooms within the same App space.
       * @method getPeers
       * @param {Boolean} [showAll=false] The flag if Signaling server should also return the list of privileged Peer IDs.
       * &lt;small&gt;By default, the Signaling server does not include the list of privileged Peer IDs in the return result.&lt;/small&gt;
       * @param {Function} [callback] The callback function fired when request has completed.
       *   &lt;small&gt;Function parameters signature is &lt;code&gt;function (error, success)&lt;/code&gt;&lt;/small&gt;
       *   &lt;small&gt;Function request completion is determined by the &lt;a href=&quot;#event_getPeersStateChange&quot;&gt;
       *   &lt;code&gt;getPeersStateChange&lt;/code&gt; event&lt;/a&gt; triggering &lt;code&gt;state&lt;/code&gt; parameter payload value as
       *   &lt;code&gt;RECEIVED&lt;/code&gt; for request success.&lt;/small&gt;
       *   [Rel: Skylink.GET_PEERS_STATE]
       * @param {Error|String} callback.error The error result in request.
       *   &lt;small&gt;Defined as &lt;code&gt;null&lt;/code&gt; when there are no errors in request&lt;/small&gt;
       *   &lt;small&gt;Object signature is the &lt;code&gt;getPeers()&lt;/code&gt; error when retrieving list of Peer IDs from Rooms
       *   within the same App space.&lt;/small&gt;
       * @param {JSON} callback.success The success result in request.
       *   &lt;small&gt;Defined as &lt;code&gt;null&lt;/code&gt; when there are errors in request&lt;/small&gt;
       *   &lt;small&gt;Object signature matches the &lt;code&gt;peerList&lt;/code&gt; parameter payload received in the
       *   &lt;a href=&quot;#event_getPeersStateChange&quot;&gt;&lt;code&gt;getPeersStateChange&lt;/code&gt; event&lt;/a&gt;.&lt;/small&gt;
       * @trigger &lt;ol class=&quot;desc-seq&quot;&gt;
       *   &lt;li&gt;If App Key provided in the &lt;a href=&quot;#method_init&quot;&gt;&lt;code&gt;init()&lt;/code&gt; method&lt;/a&gt; is not
       *   a Privileged enabled Key: &lt;ol&gt;&lt;li&gt;&lt;b&gt;ABORT&lt;/b&gt; and return error.&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;
       *   &lt;li&gt;Retrieves the list of Peer IDs from Rooms within the same App space. &lt;ol&gt;
       *   &lt;li&gt;&lt;a href=&quot;#event_getPeersStateChange&quot;&gt;&lt;code&gt;getPeersStateChange&lt;/code&gt; event&lt;/a&gt; triggers parameter
       *   payload &lt;code&gt;state&lt;/code&gt; value as &lt;code&gt;ENQUIRED&lt;/code&gt;.&lt;/li&gt;
       *   &lt;li&gt;If received list from Signaling server successfully: &lt;ol&gt;
       *   &lt;li&gt;&lt;a href=&quot;#event_getPeersStateChange&quot;&gt;&lt;code&gt;getPeersStateChange&lt;/code&gt; event&lt;/a&gt; triggers parameter
       *   payload &lt;code&gt;state&lt;/code&gt; value as &lt;code&gt;RECEIVED&lt;/code&gt;.&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;/ol&gt;
       * @example
       *   // Example 1: Retrieving the un-privileged Peers
       *   skylinkDemo.joinRoom(function (jRError, jRSuccess) {
       *     if (jRError) return;
       *     skylinkDemo.getPeers(function (error, success) {
       *        if (error) return;
       *        console.log(&quot;The list of only un-privileged Peers in the same App space -&gt;&quot;, success);
       *     });
       *   });
       *
       *   // Example 2: Retrieving the all Peers (privileged or un-privileged)
       *   skylinkDemo.joinRoom(function (jRError, jRSuccess) {
       *     if (jRError) return;
       *     skylinkDemo.getPeers(true, function (error, success) {
       *        if (error) return;
       *        console.log(&quot;The list of all Peers in the same App space -&gt;&quot;, success);
       *     });
       *   });
       * @for Skylink
       * @since 0.6.1
       */
      Skylink.prototype.getPeers = function(showAll, callback){
      	var self = this;
      	if (!self._isPrivileged){
      		log.warn(&#x27;Please upgrade your key to privileged to use this function&#x27;);
      		return;
      	}
      	if (!self._appKey){
      		log.warn(&#x27;App key is not defined. Please authenticate again.&#x27;);
      		return;
      	}
      
      	// Only callback is provided
      	if (typeof showAll === &#x27;function&#x27;){
      		callback = showAll;
      		showAll = false;
      	}
      
      	self._sendChannelMessage({
      		type: self._SIG_MESSAGE_TYPE.GET_PEERS,
      		showAll: showAll || false
      	});
      
      	self._trigger(&#x27;getPeersStateChange&#x27;,self.GET_PEERS_STATE.ENQUIRED, self._user.sid, null);
      
      	log.log(&#x27;Enquired server for peers within the realm&#x27;);
      
      	if (typeof callback === &#x27;function&#x27;){
      		self.once(&#x27;getPeersStateChange&#x27;, function(state, privilegedPeerId, peerList){
      			callback(null, peerList);
      		}, function(state, privilegedPeerId, peerList){
      			return state === self.GET_PEERS_STATE.RECEIVED;
      		});
      	}
      
      };
      
      /**
       * &lt;blockquote class=&quot;info&quot;&gt;
       *   Note that this feature requires &lt;code&gt;&quot;isPrivileged&quot;&lt;/code&gt; flag to be enabled and
       *   &lt;code&gt;&quot;autoIntroduce&quot;&lt;/code&gt; flag to be disabled for the App Key provided in the
       *   &lt;a href=&quot;#method_init&quot;&gt;&lt;code&gt;init()&lt;/code&gt; method&lt;/a&gt;, as only Users connecting using
       *   the App Key with this flag enabled (which we call privileged Users / Peers) can retrieve the list of
       *   Peer IDs from Rooms within the same App space.
       *   &lt;a href=&quot;http://support.temasys.io/support/solutions/articles/12000012342-what-is-a-privileged-key-&quot;&gt;
       *   Read more about privileged App Key feature here&lt;/a&gt;.
       * &lt;/blockquote&gt;
       * Function that selects and introduces a pair of Peers to start connection with each other.
       * @method introducePeer
       * @param {String} sendingPeerId The Peer ID to be connected with &lt;code&gt;receivingPeerId&lt;/code&gt;.
       * @param {String} receivingPeerId The Peer ID to be connected with &lt;code&gt;sendingPeerId&lt;/code&gt;.
       * @trigger &lt;ol class=&quot;desc-seq&quot;&gt;
       *   &lt;li&gt;If App Key provided in the &lt;a href=&quot;#method_init&quot;&gt;&lt;code&gt;init()&lt;/code&gt; method&lt;/a&gt; is not
       *   a Privileged enabled Key: &lt;ol&gt;&lt;li&gt;&lt;b&gt;ABORT&lt;/b&gt; and return error.&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;
       *   &lt;li&gt;Starts sending introduction request for the selected pair of Peers to the Signaling server. &lt;ol&gt;
       *   &lt;li&gt;&lt;a href=&quot;#event_introduceStateChange&quot;&gt;&lt;code&gt;introduceStateChange&lt;/code&gt; event&lt;/a&gt; triggers parameter
       *   payload &lt;code&gt;state&lt;/code&gt; value as &lt;code&gt;INTRODUCING&lt;/code&gt;.&lt;/li&gt;
       *   &lt;li&gt;If received errors from Signaling server: &lt;ol&gt;
       *   &lt;li&gt;&lt;a href=&quot;#event_introduceStateChange&quot;&gt;&lt;code&gt;introduceStateChange&lt;/code&gt; event&lt;/a&gt; triggers parameter
       *   payload &lt;code&gt;state&lt;/code&gt; value as &lt;code&gt;ERROR&lt;/code&gt;.&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;/ol&gt;
       * @example
       *   // Example 1: Introduce a pair of Peers
       *   skylinkDemo.on(&quot;introduceStateChange&quot;, function (state, privilegedPeerId, sendingPeerId, receivingPeerId) {
       *	   if (state === skylinkDemo.INTRODUCE_STATE.INTRODUCING) {
       *       console.log(&quot;Peer &#x27;&quot; + sendingPeerId + &quot;&#x27; has been introduced to &#x27;&quot; + receivingPeerId + &quot;&#x27;&quot;);
       *     }
       *   });
       *
       *   skylinkDemo.joinRoom(function (jRError, jRSuccess) {
       *     if (jRError) return;
       *     skylinkDemo.getPeers(function (gPError, gPSuccess) {
       *        if (gPError) return;
       *        skylinkDemo.introducePeer(gPSuccess.roomName[0], gPSuccess.roomName[1]);
       *     });
       *   });
       * @for Skylink
       * @since 0.6.1
       */
      Skylink.prototype.introducePeer = function(sendingPeerId, receivingPeerId){
      	var self = this;
      	if (!self._isPrivileged){
      		log.warn(&#x27;Please upgrade your key to privileged to use this function&#x27;);
      		self._trigger(&#x27;introduceStateChange&#x27;, self.INTRODUCE_STATE.ERROR, self._user.sid, sendingPeerId, receivingPeerId, &#x27;notPrivileged&#x27;);
      		return;
      	}
      	self._sendChannelMessage({
      		type: self._SIG_MESSAGE_TYPE.INTRODUCE,
      		sendingPeerId: sendingPeerId,
      		receivingPeerId: receivingPeerId
      	});
      	self._trigger(&#x27;introduceStateChange&#x27;, self.INTRODUCE_STATE.INTRODUCING, self._user.sid, sendingPeerId, receivingPeerId, null);
      	log.log(&#x27;Introducing&#x27;,sendingPeerId,&#x27;to&#x27;,receivingPeerId);
      };
      
      
          </pre>
      </div>
    </div>
   </section>
</body>
</html>
